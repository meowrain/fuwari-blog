---
title: HashMapåŸç†
published: 2025-07-18
description: ''
image: ''
tags: [HashMap,Java]
category: 'Java > é›†åˆæ¡†æ¶'
draft: false 
lang: ''
---


# è¯´è¯´HashMapçš„åŸç†

HashMapæ˜¯åŸºäºå“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨é”®å€¼å¯¹ã€‚
æ ¸å¿ƒæ˜¯å°†é”®çš„å“ˆå¸Œå€¼æ˜ å°„åˆ°æ•°ç»„ç´¢å¼•ä½ç½®ï¼Œé€šè¿‡æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘æ¥è§£å†³å“ˆå¸Œå†²çªã€‚

HashMapä½¿ç”¨é”®çš„hashCode()æ–¹æ³•è®¡ç®—å“ˆå¸Œå€¼ï¼Œé€šè¿‡`(n-1) &hash`ç¡®å®šå…ƒç´ åœ¨æ•°ç»„ä¸­çš„å­˜å‚¨ä½ç½®ã€‚

å“ˆå¸Œå€¼æ˜¯ç»è¿‡ä¸€å®šçš„æ‰°åŠ¨å¤„ç†çš„ï¼Œé˜²æ­¢å“ˆå¸Œå€¼åˆ†å¸ƒä¸å‡ï¼Œä»è€Œå‡å°‘å†²çªï¼Œ

HashMapçš„é»˜è®¤åˆå§‹å®¹é‡ä¸º16ï¼Œè´Ÿè½½å› å­ä¸º0.75ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å­˜å‚¨çš„å…ƒç´ æ•°é‡è¶…è¿‡16 * 0.75 = 12ä¸ªçš„æ—¶å€™ï¼ŒHashMapä¼šè§¦å‘æ‰©å®¹æ“ä½œï¼Œå®¹é‡x2å¹¶é‡æ–°åˆ†é…å…ƒç´ ä½ç½®ï¼Œè¿™ç§æ‰©å®¹æ˜¯æ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œé¢‘ç¹æ‰©å®¹ä¼šå½±å“æ€§èƒ½ã€‚

# é€šè¿‡æºç æ·±å…¥äº†è§£HashMap

```java
    // é»˜è®¤åˆå§‹å®¹é‡ - å¿…é¡»æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ã€‚
    static final int DEFAULT_INITIAL_CAPACITY = 1 << 4; // å³ 16

    // æœ€å¤§å®¹é‡ï¼Œå¦‚æœæ„é€ å‡½æ•°ä¸­é€šè¿‡å‚æ•°éšå¼æŒ‡å®šäº†æ›´é«˜çš„å€¼ï¼Œåˆ™ä½¿ç”¨æ­¤æœ€å¤§å®¹é‡ã€‚
    // å¿…é¡»æ˜¯å°äºç­‰äº 1 << 30 çš„ 2 çš„å¹‚æ¬¡æ–¹ã€‚
    // ç”±äºä½ å¯ä»¥éšæ—¶æŒ‡å®šéå¸¸å¤§ï¼ˆç”šè‡³è¶…è¿‡äº†1äº¿ï¼‰çš„å€¼ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜æº¢å‡ºæˆ–æ•°ç»„é•¿åº¦æ— æ•ˆï¼ŒHashMapå†…éƒ¨é€šè¿‡MAXIMUM_CAPACITYåšäº†ä¸€ä¸ªâ€œä¿é™©â€ï¼Œæ¥ç¡®ä¿å®¹é‡ä¸ä¼šè¶…è¿‡æŸä¸ªå®‰å…¨æé™ã€‚
    static final int MAXIMUM_CAPACITY = 1 << 30;

    // æ„é€ å‡½æ•°ä¸­æœªæŒ‡å®šæ—¶ä½¿ç”¨çš„è´Ÿè½½å› å­ã€‚
    static final float DEFAULT_LOAD_FACTOR = 0.75f;

    // åœ¨å‘å­˜å‚¨å•å…ƒæ·»åŠ å…ƒç´ æ—¶ï¼Œå­˜å‚¨å•å…ƒä½¿ç”¨æ ‘ç»“æ„è€Œä¸æ˜¯é“¾è¡¨ç»“æ„çš„å­˜å‚¨å•å…ƒè®¡æ•°é˜ˆå€¼ã€‚
    // å½“å‘å­˜å‚¨å•å…ƒæ·»åŠ å…ƒç´ ï¼Œä¸”è¯¥å­˜å‚¨å•å…ƒè‡³å°‘æœ‰æ­¤æ•°é‡çš„èŠ‚ç‚¹æ—¶ï¼Œå­˜å‚¨å•å…ƒå°†è½¬æ¢ä¸ºæ ‘ç»“æ„ã€‚
    // è¯¥å€¼å¿…é¡»å¤§äº 2ï¼Œå¹¶ä¸”åº”è¯¥è‡³å°‘ä¸º 8ï¼Œä»¥ä¸ç§»é™¤å…ƒç´ æ—¶è½¬æ¢å›æ™®é€šå­˜å‚¨å•å…ƒçš„å‡è®¾ç›¸åŒ¹é…ã€‚
    static final int TREEIFY_THRESHOLD = 8;

    // åœ¨è°ƒæ•´å¤§å°æ“ä½œæœŸé—´å°†ï¼ˆæ‹†åˆ†çš„ï¼‰å­˜å‚¨å•å…ƒè½¬æ¢ä¸ºéæ ‘ç»“æ„å­˜å‚¨å•å…ƒçš„å­˜å‚¨å•å…ƒè®¡æ•°é˜ˆå€¼ã€‚
    // åº”è¯¥å°äº TREEIFY_THRESHOLDï¼Œå¹¶ä¸”æœ€å¤šä¸º 6ï¼Œä»¥ä¸ç§»é™¤å…ƒç´ æ—¶çš„æ”¶ç¼©æ£€æµ‹ç›¸åŒ¹é…ã€‚
    static final int UNTREEIFY_THRESHOLD = 6;

    // å­˜å‚¨å•å…ƒå¯ä»¥æ ‘åŒ–çš„æœ€å°è¡¨å®¹é‡ã€‚
    // ï¼ˆå¦åˆ™ï¼Œå¦‚æœå­˜å‚¨å•å…ƒä¸­æœ‰å¤ªå¤šèŠ‚ç‚¹ï¼Œè¡¨å°†è¿›è¡Œæ‰©å®¹ã€‚ï¼‰
    // åº”è¯¥è‡³å°‘æ˜¯ 4 * TREEIFY_THRESHOLDï¼Œä»¥é¿å…æ‰©å®¹å’Œæ ‘åŒ–é˜ˆå€¼ä¹‹é—´çš„å†²çªã€‚
    static final int MIN_TREEIFY_CAPACITY = 64;

```

![](https://blog.meowrain.cn/api/i/2025/06/13/nm8tvy-0.webp)

# HashMapçš„å­˜å‚¨ç»“æ„

ä»æºç ä¸Šçœ‹ï¼ŒHashMapçš„æ¯ä¸ªå­˜å‚¨å•å…ƒéƒ½æ˜¯ä¸€ä¸ªé“¾è¡¨æˆ–è€…çº¢é»‘æ ‘ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢çš„Nodeç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„å›¾æ¥å±•ç¤ºä¸€ä¸ªå®Œæˆåˆå§‹åŒ–çš„HashMapçš„å­˜å‚¨ç»“æ„ã€‚

![](https://blog.meowrain.cn/api/i/2025/06/13/nnlf4v-0.webp)

### ä¸ºä»€ä¹ˆé‡‡ç”¨æ•°ç»„ï¼Ÿ

å› ä¸ºæ•°ç»„çš„éšæœºè®¿é—®é€Ÿåº¦éå¸¸å¿«ï¼ŒHashMapé€šè¿‡å“ˆå¸Œå‡½æ•°å°†é”®æ˜ å°„åˆ°æ•°ç»„ç´¢å¼•ä½ç½®ï¼Œä»è€Œå®ç°å¿«é€ŸæŸ¥æ‰¾ã€‚

æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ç§°ä¸ºä¸€ä¸ªæ¡¶ï¼ˆbucketï¼‰ï¼Œå¯¹äºä¸€ä¸ªç»™å®šçš„é”®å€¼å¯¹key,valueï¼ŒHashMapä¼šè®¡ç®—å‡ºä¸€ä¸ªå“ˆå¸Œå€¼ï¼ˆè®¡ç®—çš„æ˜¯keyçš„hashï¼‰ï¼Œç„¶åé€šè¿‡`(n-1) & hash`æ¥ç¡®å®šè¯¥é”®å€¼å¯¹åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚

### å¦‚ä½•å®šä½key valueè¯¥å­˜å‚¨åœ¨æ¡¶æ•°ç»„çš„å“ªä¸ªä½ç½®ä¸Šï¼Ÿï¼ˆè·å–indexï¼‰

HashMapé€šè¿‡`(n - 1) & hash`æ¥è®¡ç®—ç´¢å¼•ä½ç½®ï¼Œå…¶ä¸­næ˜¯æ•°ç»„çš„é•¿åº¦ï¼Œhashæ˜¯é”®çš„å“ˆå¸Œå€¼ã€‚

### å¦‚ä½•è®¡ç®—hashå€¼ï¼Ÿ

HashMapä½¿ç”¨é”®çš„`hashCode()`æ–¹æ³•è®¡ç®—å“ˆå¸Œå€¼ï¼Œç„¶åå¯¹å“ˆå¸Œå€¼è¿›è¡Œæ‰°åŠ¨å¤„ç†ï¼Œæœ€åé€šè¿‡`(n-1) & hash`æ¥ç¡®å®šå…ƒç´ åœ¨æ•°ç»„ä¸­çš„å­˜å‚¨ä½ç½®ã€‚

### ä¸ºä»€ä¹ˆè¦æ‰°åŠ¨å¤„ç†ï¼Ÿ

æ‰°åŠ¨å¤„ç†æ˜¯ä¸ºäº†å‡å°‘å“ˆå¸Œå†²çªï¼Œé˜²æ­¢å“ˆå¸Œå€¼åˆ†å¸ƒä¸å‡ã€‚HashMapä¼šå¯¹å“ˆå¸Œå€¼è¿›è¡Œæ‰°åŠ¨å¤„ç†ï¼Œä»¥ç¡®ä¿ä¸åŒçš„é”®èƒ½å¤Ÿæ›´å‡åŒ€åœ°åˆ†å¸ƒåœ¨æ•°ç»„ä¸­ï¼Œä»è€Œå‡å°‘å†²çªã€‚

åœ¨Java 8ä¸­ï¼ŒHashMapä½¿ç”¨äº†ä¸€ä¸ªæ‰°åŠ¨å‡½æ•°æ¥ä¼˜åŒ–hashå€¼çš„åˆ†å¸ƒï¼š

```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
}
```

è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯ï¼š

1. é¦–å…ˆè·å–keyçš„hashCode()å€¼
2. å°†hashCodeçš„é«˜16ä½ä¸ä½16ä½è¿›è¡Œå¼‚æˆ–è¿ç®—

### ä¸ºä»€ä¹ˆç”¨çš„æ˜¯&è¿ç®—è€Œä¸æ˜¯å–æ¨¡è¿ç®—ï¼Ÿ

åœ¨javaä¸­ï¼Œæˆ‘ä»¬ä¼šè®©HashMapçš„å®¹é‡æ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Œè¿™æ ·å¯ä»¥é€šè¿‡`(n-1) & hash`æ¥å¿«é€Ÿè®¡ç®—å‡ºç´¢å¼•ä½ç½®ï¼Œé¿å…äº†å–æ¨¡è¿ç®—çš„æ€§èƒ½å¼€é”€ã€‚

è¿™é‡Œ`(n - 1) & hash` == `hash % n`ï¼Œä½†&è¿ç®—æ¯”å–æ¨¡è¿ç®—æ›´é«˜æ•ˆã€‚

næ˜¯æ•°ç»„çš„é•¿åº¦ï¼Œhashæ˜¯é”®çš„å“ˆå¸Œå€¼ã€‚

### ä¸ºä»€ä¹ˆè¦è®©HashMapçš„å®¹é‡æ˜¯2çš„å¹‚æ¬¡æ–¹ï¼Ÿ

å› ä¸ºå½“å®¹é‡æ˜¯2çš„å¹‚æ¬¡æ–¹æ—¶ï¼Œ`(n-1) & hash`å¯ä»¥å¿«é€Ÿè®¡ç®—å‡ºç´¢å¼•ä½ç½®ï¼Œè€Œä¸éœ€è¦è¿›è¡Œå–æ¨¡è¿ç®—ã€‚

![](https://blog.meowrain.cn/api/i/2025/06/13/nqocqh-0.webp)

### ä¸ºä»€ä¹ˆä¼šç”¨åˆ°é“¾è¡¨ï¼Ÿ

æˆ‘ä»¬åœ¨HashMapçš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å“ˆå¸Œå†²çªçš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯ä¸åŒçš„é”®ç»è¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—åå¾—åˆ°äº†ç›¸åŒçš„ç´¢å¼•ä½ç½®ï¼Œä½¿ç”¨é“¾è¡¨æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›å†²çªçš„é”®å€¼å¯¹å­˜å‚¨åœ¨åŒä¸€ä¸ªæ¡¶ä¸­ï¼Œç”¨é“¾è¡¨è¿æ¥åœ¨ä¸€èµ·ï¼Œjdk8å¼€å§‹ï¼Œé“¾è¡¨èŠ‚ç‚¹ä¸å†ä½¿ç”¨å¤´æ’æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨å°¾æ’æ³•ï¼Œè¿™æ ·å¯ä»¥å‡å°‘é“¾è¡¨çš„é•¿åº¦ï¼Œæå‡æŸ¥æ‰¾æ•ˆç‡ã€‚

å¤´æ’æ³•è¿˜å¯èƒ½é€ æˆé“¾è¡¨å½¢æˆç¯å½¢ï¼Œå¯¼è‡´æ­»å¾ªç¯ã€‚

![](https://blog.meowrain.cn/api/i/2025/06/13/nva4ft-0.webp)

## Node

```java
 static class Node<K,V> implements Map.Entry<K,V> {
        final int hash;
        final K key;
        V value;
        Node<K,V> next;

        Node(int hash, K key, V value, Node<K,V> next) {
            this.hash = hash;
            this.key = key;
            this.value = value;
            this.next = next;
        }

        public final K getKey()        { return key; }
        public final V getValue()      { return value; }
        public final String toString() { return key + "=" + value; }

        public final int hashCode() {
            return Objects.hashCode(key) ^ Objects.hashCode(value);
        }

        public final V setValue(V newValue) {
            V oldValue = value;
            value = newValue;
            return oldValue;
        }

        public final boolean equals(Object o) {
            if (o == this)
                return true;

            return o instanceof Map.Entry<?, ?> e
                    && Objects.equals(key, e.getKey())
                    && Objects.equals(value, e.getValue());
        }
    }

```

# HashMapçš„Putæ–¹æ³•

HashMapçš„putæ–¹æ³•æ˜¯ç”¨æ¥æ·»åŠ é”®å€¼å¯¹åˆ°HashMapä¸­çš„æ ¸å¿ƒæ–¹æ³•ã€‚å®ƒçš„å®ç°é€»è¾‘å¦‚ä¸‹ï¼š

```java
  /**
   * å®ç° Map.put å’Œç›¸å…³æ–¹æ³•ã€‚
   *
   * @param hash keyçš„å“ˆå¸Œå€¼
   * @param key é”®
   * @param value è¦æ”¾å…¥çš„å€¼
   * @param onlyIfAbsent å¦‚æœä¸º trueï¼Œåˆ™ä¸æ›´æ”¹ç°æœ‰å€¼
   * @param evict å¦‚æœä¸º falseï¼Œåˆ™è¡¨å¤„äºåˆ›å»ºæ¨¡å¼ã€‚
   * @return è¿”å›å…ˆå‰çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å› null
   */
  final V putVal(int hash, K key, V value, boolean onlyIfAbsent,
           boolean evict) { // ğŸ“Œ å®šä¹‰ putVal æ–¹æ³•ï¼Œç”¨äºå°†é”®å€¼å¯¹æ”¾å…¥ HashMap
    Node<K,V>[] tab; Node<K,V> p; int n, i; // ğŸ·ï¸ å£°æ˜å±€éƒ¨å˜é‡ï¼štab (å“ˆå¸Œè¡¨æ•°ç»„), p (å½“å‰èŠ‚ç‚¹), n (æ•°ç»„é•¿åº¦), i (æ•°ç»„ç´¢å¼•)
    // æ£€æŸ¥å“ˆå¸Œè¡¨æ˜¯å¦ä¸ºç©ºæˆ–é•¿åº¦ä¸º0
    if ((tab = table) == null || (n = tab.length) == 0)
      // ğŸ—ï¸ å¦‚æœä¸ºç©ºï¼Œåˆ™è°ƒç”¨ resize() æ–¹æ³•åˆå§‹åŒ–æˆ–æ‰©å®¹å“ˆå¸Œè¡¨ï¼Œå¹¶è·å–æ–°çš„é•¿åº¦
      n = (tab = resize()).length;
    // ğŸ¯ è®¡ç®—é”®åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç´¢å¼•ä½ç½® iï¼Œå¹¶æ£€æŸ¥è¯¥ä½ç½®æ˜¯å¦ä¸ºç©º
    if ((p = tab[i = (n - 1) & hash]) == null)
      // âœ¨ å¦‚æœä¸ºç©ºï¼Œç›´æ¥åœ¨è¯¥ä½ç½®åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹
      tab[i] = newNode(hash, key, value, null);
    else { // ğŸ¤” å¦‚æœè¯¥ä½ç½®ä¸ä¸ºç©ºï¼ˆå‘ç”Ÿå“ˆå¸Œå†²çªï¼‰
      Node<K,V> e; K k; // ğŸ·ï¸ å£°æ˜å±€éƒ¨å˜é‡ï¼še (ç”¨äºæ‰¾åˆ°çš„å·²å­˜åœ¨èŠ‚ç‚¹æˆ–æ–°èŠ‚ç‚¹), k (ä¸´æ—¶é”®)
      // ğŸ”‘ æ£€æŸ¥æ¡¶ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„å“ˆå¸Œå€¼å’Œé”®æ˜¯å¦ä¸è¦æ’å…¥çš„é”®å€¼å¯¹åŒ¹é…
      if (p.hash == hash &&
        ((k = p.key) == key || (key != null && key.equals(k))))
        // âœ… å¦‚æœåŒ¹é…ï¼Œå°† e æŒ‡å‘è¯¥èŠ‚ç‚¹ p (è¡¨ç¤ºé”®å·²å­˜åœ¨)
        e = p;
      // ğŸŒ³ æ£€æŸ¥æ¡¶ä¸­çš„èŠ‚ç‚¹æ˜¯å¦ä¸º TreeNode (çº¢é»‘æ ‘èŠ‚ç‚¹)
      else if (p instanceof TreeNode)
        // ğŸŒ² å¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œè°ƒç”¨ putTreeVal æ–¹æ³•å°†é”®å€¼å¯¹æ’å…¥çº¢é»‘æ ‘
        e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
      else { // ğŸ”— å¦‚æœæ˜¯é“¾è¡¨
        // ğŸ”„ éå†é“¾è¡¨
        for (int binCount = 0; ; ++binCount) {
          //  Ù†Ù‡Ø§ÙŠØ© æ£€æŸ¥å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºç©º (åˆ°è¾¾é“¾è¡¨å°¾éƒ¨)
          if ((e = p.next) == null) {
            // â• åœ¨é“¾è¡¨å°¾éƒ¨æ’å…¥æ–°èŠ‚ç‚¹
            p.next = newNode(hash, key, value, null);
            // ğŸŒ²â“ æ£€æŸ¥é“¾è¡¨é•¿åº¦æ˜¯å¦è¾¾åˆ°æ ‘åŒ–é˜ˆå€¼ (TREEIFY_THRESHOLD - 1 å› ä¸º binCount ä»0å¼€å§‹è®¡æ•°ï¼Œä¸”å½“å‰pæ˜¯å°¾éƒ¨çš„å‰ä¸€ä¸ªèŠ‚ç‚¹)
            if (binCount >= TREEIFY_THRESHOLD - 1) // -1 for 1st
              // ğŸŒ³ğŸ”—â¡ï¸ğŸŒ³ å¦‚æœè¾¾åˆ°é˜ˆå€¼ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘
              treeifyBin(tab, hash);
            break; // ğŸ›‘ è·³å‡ºå¾ªç¯ï¼Œå› ä¸ºæ–°èŠ‚ç‚¹å·²æ’å…¥
          }
          // ğŸ”‘ æ£€æŸ¥é“¾è¡¨ä¸­èŠ‚ç‚¹çš„å“ˆå¸Œå€¼å’Œé”®æ˜¯å¦ä¸è¦æ’å…¥çš„é”®å€¼å¯¹åŒ¹é…
          if (e.hash == hash &&
            ((k = e.key) == key || (key != null && key.equals(k))))
            break; // âœ… å¦‚æœåŒ¹é…ï¼Œè·³å‡ºå¾ªç¯ (è¡¨ç¤ºé”®å·²å­˜åœ¨ï¼Œe æŒ‡å‘è¯¥èŠ‚ç‚¹)
          // ğŸ‘‰ å°† p æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç»§ç»­éå†
          p = e;
        }
      }
      // ğŸ”‘â“ æ£€æŸ¥ e æ˜¯å¦ä¸ä¸º null (è¡¨ç¤ºé”®å·²å­˜åœ¨äºå“ˆå¸Œè¡¨ä¸­ï¼Œæˆ–è€…åœ¨çº¢é»‘æ ‘ä¸­æ‰¾åˆ°äº†/æ’å…¥äº†èŠ‚ç‚¹)
      if (e != null) { // existing mapping for key
        // ğŸ’¾ è·å–æ—§å€¼
        V oldValue = e.value;
        // ğŸ”„â“ æ ¹æ® onlyIfAbsent å‚æ•°å†³å®šæ˜¯å¦æ›´æ–°å€¼ (å¦‚æœ onlyIfAbsent ä¸º falseï¼Œæˆ–è€…æ—§å€¼ä¸º nullï¼Œåˆ™æ›´æ–°)
        if (!onlyIfAbsent || oldValue == null)
          // â¬†ï¸ æ›´æ–°èŠ‚ç‚¹çš„å€¼
          e.value = value;
        // ğŸ”— å›è°ƒæ–¹æ³•ï¼Œç”¨äº LinkedHashMap ç­‰å­ç±»è®°å½•èŠ‚ç‚¹è®¿é—®
        afterNodeAccess(e);
        // â†©ï¸ è¿”å›æ—§å€¼
        return oldValue;
      }
    }
    // ğŸ› ï¸ ä¿®æ”¹è®¡æ•°å™¨åŠ 1ï¼Œç”¨äºè¿­ä»£å™¨å¿«é€Ÿå¤±è´¥æœºåˆ¶
    ++modCount;
    // ğŸ“ˆ æ£€æŸ¥å½“å‰å…ƒç´ æ•°é‡æ˜¯å¦è¶…è¿‡é˜ˆå€¼ (threshold = capacity * loadFactor)
    if (++size > threshold)
      // ğŸ—ï¸ å¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œè°ƒç”¨ resize() æ–¹æ³•æ‰©å®¹å“ˆå¸Œè¡¨
      resize();
    // ğŸ”— å›è°ƒæ–¹æ³•ï¼Œç”¨äº LinkedHashMap ç­‰å­ç±»è®°å½•èŠ‚ç‚¹æ’å…¥
    afterNodeInsertion(evict);
    // â†©ï¸ å¦‚æœæ˜¯æ–°æ’å…¥çš„é”®å€¼å¯¹ï¼Œè¿”å› null
    return null;
  }
```

![](https://blog.meowrain.cn/api/i/2025/06/13/nzkmzk-0.webp)

# HashMapçš„Getæ–¹æ³•

```java
  /**
   * å®ç° Map.get å’Œç›¸å…³æ–¹æ³•ã€‚
   *
   * @param key è¦æŸ¥æ‰¾çš„é”®
   * @return è¿”å›æ‰¾åˆ°çš„èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å› null
   */
  final Node<K,V> getNode(Object key) { // ğŸ“Œ å®šä¹‰ getNode æ–¹æ³•ï¼Œç”¨äºæ ¹æ®é”®æŸ¥æ‰¾èŠ‚ç‚¹
    Node<K,V>[] tab; Node<K,V> first, e; int n, hash; K k; // ğŸ·ï¸ å£°æ˜å±€éƒ¨å˜é‡ï¼štab (å“ˆå¸Œè¡¨æ•°ç»„), first (æ¡¶ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹), e (å½“å‰èŠ‚ç‚¹), n (æ•°ç»„é•¿åº¦), hash (é”®çš„å“ˆå¸Œå€¼), k (ä¸´æ—¶é”®)
    // ğŸ” æ£€æŸ¥å“ˆå¸Œè¡¨æ˜¯å¦ä¸ä¸ºç©ºä¸”é•¿åº¦å¤§äº0ï¼Œå¹¶ä¸”æ ¹æ®é”®çš„å“ˆå¸Œå€¼è®¡ç®—å‡ºçš„æ¡¶ä½ç½®æœ‰èŠ‚ç‚¹
    if ((tab = table) != null && (n = tab.length) > 0 &&
      (first = tab[(n - 1) & (hash = hash(key))]) != null) {
      // ğŸ¯ é¦–å…ˆæ£€æŸ¥æ¡¶ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„å“ˆå¸Œå€¼å’Œé”®æ˜¯å¦ä¸è¦æŸ¥æ‰¾çš„é”®åŒ¹é…
      if (first.hash == hash && // always check first node æ€»æ˜¯å…ˆæ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
        ((k = first.key) == key || (key != null && key.equals(k))))
        // âœ… å¦‚æœåŒ¹é…ï¼Œç›´æ¥è¿”å›ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
        return first;
      // ğŸ”— æ£€æŸ¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆé“¾è¡¨æˆ–çº¢é»‘æ ‘ï¼‰
      if ((e = first.next) != null) {
        // ğŸŒ³ å¦‚æœç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ TreeNodeï¼ˆçº¢é»‘æ ‘èŠ‚ç‚¹ï¼‰
        if (first instanceof TreeNode)
          // ğŸŒ² åœ¨çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾å¹¶è¿”å›èŠ‚ç‚¹
          return ((TreeNode<K,V>)first).getTreeNode(hash, key);
        // ğŸ”„ å¦‚æœæ˜¯é“¾è¡¨ï¼Œéå†é“¾è¡¨æŸ¥æ‰¾èŠ‚ç‚¹
        do {
          // ğŸ”‘ æ£€æŸ¥å½“å‰èŠ‚ç‚¹çš„å“ˆå¸Œå€¼å’Œé”®æ˜¯å¦ä¸è¦æŸ¥æ‰¾çš„é”®åŒ¹é…
          if (e.hash == hash &&
            ((k = e.key) == key || (key != null && key.equals(k))))
            // âœ… å¦‚æœåŒ¹é…ï¼Œè¿”å›å½“å‰èŠ‚ç‚¹
            return e;
        // ğŸ‘‰ ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç»§ç»­éå†ç›´åˆ°é“¾è¡¨æœ«å°¾
        } while ((e = e.next) != null);
      }
    }
    // âŒ å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„èŠ‚ç‚¹ï¼Œè¿”å› null
    return null;
  }
```

![](https://blog.meowrain.cn/api/i/2025/06/13/o2aa3y-0.webp)

# HashMapçš„æ‰©å®¹

HashMapçš„æ‰©å®¹æ˜¯æŒ‡å½“å­˜å‚¨çš„å…ƒç´ æ•°é‡è¶…è¿‡è´Ÿè½½å› å­æ‰€å…è®¸çš„æœ€å¤§æ•°é‡æ—¶ï¼ŒHashMapä¼šè‡ªåŠ¨å¢åŠ å…¶å®¹é‡ã€‚
æ‰©å®¹çš„è¿‡ç¨‹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

1. **è®¡ç®—æ–°çš„å®¹é‡**ï¼šæ–°çš„å®¹é‡é€šå¸¸æ˜¯å½“å‰å®¹é‡çš„ä¸¤å€ã€‚
2. **åˆ›å»ºæ–°çš„æ•°ç»„**ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„æ¥å­˜å‚¨æ‰©å®¹åçš„å…ƒç´ ã€‚
3. **é‡æ–°è®¡ç®—ç´¢å¼•ä½ç½®**ï¼šå¯¹äºæ¯ä¸ªå…ƒç´ ï¼Œé‡æ–°è®¡ç®—å…¶åœ¨æ–°æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®ï¼Œå¹¶å°†å…¶ç§»åŠ¨åˆ°æ–°æ•°ç»„ä¸­ã€‚

æºç ä¸­æ˜¯resize()å‡½æ•°

```java
/**
 * åˆå§‹åŒ–æˆ–å°†è¡¨å¤§å°æ‰©å¤§ä¸€å€ã€‚å¦‚æœä¸ºnullï¼Œåˆ™æ ¹æ®å­—æ®µthresholdä¸­ä¿å­˜çš„åˆå§‹å®¹é‡ç›®æ ‡è¿›è¡Œåˆ†é…ã€‚
 * å¦åˆ™ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯2çš„å¹‚æ¬¡æ–¹æ‰©å±•ï¼Œæ¯ä¸ªæ¡¶ä¸­çš„å…ƒç´ å¿…é¡»ä¿æŒåœ¨ç›¸åŒçš„ç´¢å¼•ä½ç½®ï¼Œ
 * æˆ–è€…åœ¨æ–°è¡¨ä¸­ä»¥2çš„å¹‚æ¬¡æ–¹åç§»é‡ç§»åŠ¨ã€‚
 *
 * @return è¿”å›æ–°çš„å“ˆå¸Œè¡¨
 */
final Node<K,V>[] resize() { // ğŸ“ å®šä¹‰æ‰©å®¹æ–¹æ³•
    Node<K,V>[] oldTab = table; // ğŸ—‚ï¸ ä¿å­˜æ—§çš„å“ˆå¸Œè¡¨å¼•ç”¨
    int oldCap = (oldTab == null) ? 0 : oldTab.length; // ğŸ“Š è·å–æ—§è¡¨çš„å®¹é‡ï¼Œå¦‚æœä¸ºnullåˆ™å®¹é‡ä¸º0
    int oldThr = threshold; // ğŸ“‹ ä¿å­˜æ—§çš„é˜ˆå€¼
    int newCap, newThr = 0; // ğŸ†• å£°æ˜æ–°å®¹é‡å’Œæ–°é˜ˆå€¼å˜é‡
    
    // ğŸ” å¦‚æœæ—§å®¹é‡å¤§äº0ï¼ˆè¡¨å·²åˆå§‹åŒ–ï¼‰
    if (oldCap > 0) {
        // âš ï¸ å¦‚æœæ—§å®¹é‡å·²è¾¾åˆ°æœ€å¤§å€¼ï¼Œåˆ™ä¸å†æ‰©å®¹
        if (oldCap >= MAXIMUM_CAPACITY) {
            threshold = Integer.MAX_VALUE; // ğŸ”¢ å°†é˜ˆå€¼è®¾ä¸ºæœ€å¤§æ•´æ•°å€¼
            return oldTab; // â†©ï¸ ç›´æ¥è¿”å›æ—§è¡¨ï¼Œä¸æ‰©å®¹
        }
        // ğŸ”¢ æ–°å®¹é‡ = æ—§å®¹é‡ * 2ï¼Œä¸”ä¸è¶…è¿‡æœ€å¤§å®¹é‡ï¼Œä¸”æ—§å®¹é‡ >= é»˜è®¤åˆå§‹å®¹é‡
        else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&
                 oldCap >= DEFAULT_INITIAL_CAPACITY)
            newThr = oldThr << 1; // ğŸ“ˆ æ–°é˜ˆå€¼ = æ—§é˜ˆå€¼ * 2
    }
    // ğŸ¯ å¦‚æœæ—§å®¹é‡ä¸º0ä½†æ—§é˜ˆå€¼å¤§äº0ï¼ˆé€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šäº†åˆå§‹å®¹é‡ï¼‰
    else if (oldThr > 0)
        newCap = oldThr; // ğŸ†• æ–°å®¹é‡ç­‰äºæ—§é˜ˆå€¼
    // ğŸŒŸ å¦‚æœæ—§å®¹é‡å’Œæ—§é˜ˆå€¼éƒ½ä¸º0ï¼ˆä½¿ç”¨é»˜è®¤å€¼åˆå§‹åŒ–ï¼‰
    else {
        newCap = DEFAULT_INITIAL_CAPACITY; // ğŸ”¢ æ–°å®¹é‡è®¾ä¸ºé»˜è®¤åˆå§‹å®¹é‡16
        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); // ğŸ“Š æ–°é˜ˆå€¼ = 0.75 * 16 = 12
    }
    
    // ğŸ”§ å¦‚æœæ–°é˜ˆå€¼ä¸º0ï¼Œéœ€è¦é‡æ–°è®¡ç®—
    if (newThr == 0) {
        float ft = (float)newCap * loadFactor; // ğŸ“ è®¡ç®—æ–°é˜ˆå€¼ = æ–°å®¹é‡ * è´Ÿè½½å› å­
        // âœ… ç¡®ä¿æ–°é˜ˆå€¼ä¸è¶…è¿‡æœ€å¤§å€¼
        newThr = (newCap < MAXIMUM_CAPACITY && ft < (float)MAXIMUM_CAPACITY ?
                  (int)ft : Integer.MAX_VALUE);
    }
    
    threshold = newThr; // ğŸ“‹ æ›´æ–°é˜ˆå€¼
    @SuppressWarnings({"rawtypes","unchecked"})
    Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap]; // ğŸ—ï¸ åˆ›å»ºæ–°çš„å“ˆå¸Œè¡¨æ•°ç»„
    table = newTab; // ğŸ”„ å°†æ–°è¡¨èµ‹å€¼ç»™tableå­—æ®µ
    
    // ğŸ“¦ å¦‚æœæ—§è¡¨ä¸ä¸ºç©ºï¼Œéœ€è¦è½¬ç§»å…ƒç´ 
    if (oldTab != null) {
        // ğŸ”„ éå†æ—§è¡¨çš„æ¯ä¸ªæ¡¶
        for (int j = 0; j < oldCap; ++j) {
            Node<K,V> e; // ğŸ·ï¸ å½“å‰èŠ‚ç‚¹
            // ğŸ” å¦‚æœå½“å‰æ¡¶ä¸ä¸ºç©º
            if ((e = oldTab[j]) != null) {
                oldTab[j] = null; // ğŸ§¹ æ¸…ç©ºæ—§æ¡¶ï¼Œå¸®åŠ©GC
                
                // ğŸ”— å¦‚æœæ¡¶ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ²¡æœ‰é“¾è¡¨æˆ–çº¢é»‘æ ‘ï¼‰
                if (e.next == null)
                    newTab[e.hash & (newCap - 1)] = e; // ğŸ¯ ç›´æ¥é‡æ–°è®¡ç®—ä½ç½®å¹¶æ”¾å…¥æ–°è¡¨
                
                // ğŸŒ³ å¦‚æœæ˜¯çº¢é»‘æ ‘èŠ‚ç‚¹
                else if (e instanceof TreeNode)
                    ((TreeNode<K,V>)e).split(this, newTab, j, oldCap); // ğŸŒ² è°ƒç”¨çº¢é»‘æ ‘çš„åˆ†å‰²æ–¹æ³•
                
                // ğŸ”— å¦‚æœæ˜¯é“¾è¡¨
                else {
                    Node<K,V> loHead = null, loTail = null; // ğŸ”» ä½ä½é“¾è¡¨çš„å¤´å’Œå°¾èŠ‚ç‚¹
                    Node<K,V> hiHead = null, hiTail = null; // ğŸ”º é«˜ä½é“¾è¡¨çš„å¤´å’Œå°¾èŠ‚ç‚¹
                    Node<K,V> next; // â¡ï¸ ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
                    
                    // ğŸ”„ éå†é“¾è¡¨ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹
                    do {
                        next = e.next; // ğŸ“ ä¿å­˜ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
                        
                        // ğŸ² é€šè¿‡ (e.hash & oldCap) åˆ¤æ–­èŠ‚ç‚¹åº”è¯¥æ”¾åœ¨å“ªä¸ªä½ç½®
                        if ((e.hash & oldCap) == 0) {
                            // ğŸ”» æ”¾åœ¨åŸä½ç½®ï¼ˆä½ä½é“¾è¡¨ï¼‰
                            if (loTail == null)
                                loHead = e; // ğŸ¯ å¦‚æœä½ä½é“¾è¡¨ä¸ºç©ºï¼Œè®¾ç½®å¤´èŠ‚ç‚¹
                            else
                                loTail.next = e; // ğŸ”— è¿æ¥åˆ°ä½ä½é“¾è¡¨å°¾éƒ¨
                            loTail = e; // ğŸ“ æ›´æ–°å°¾èŠ‚ç‚¹
                        }
                        else {
                            // ğŸ”º æ”¾åœ¨åŸä½ç½®+oldCapçš„ä½ç½®ï¼ˆé«˜ä½é“¾è¡¨ï¼‰
                            if (hiTail == null)
                                hiHead = e; // ğŸ¯ å¦‚æœé«˜ä½é“¾è¡¨ä¸ºç©ºï¼Œè®¾ç½®å¤´èŠ‚ç‚¹
                            else
                                hiTail.next = e; // ğŸ”— è¿æ¥åˆ°é«˜ä½é“¾è¡¨å°¾éƒ¨
                            hiTail = e; // ğŸ“ æ›´æ–°å°¾èŠ‚ç‚¹
                        }
                    } while ((e = next) != null); // ğŸ”„ ç»§ç»­éå†ç›´åˆ°é“¾è¡¨æœ«å°¾
                    
                    // ğŸ”» å¦‚æœä½ä½é“¾è¡¨ä¸ä¸ºç©ºï¼Œæ”¾å…¥åŸä½ç½®
                    if (loTail != null) {
                        loTail.next = null; // âœ‚ï¸ æ–­å¼€é“¾è¡¨å°¾éƒ¨
                        newTab[j] = loHead; // ğŸ“ æ”¾å…¥æ–°è¡¨çš„åŸä½ç½®
                    }
                    
                    // ğŸ”º å¦‚æœé«˜ä½é“¾è¡¨ä¸ä¸ºç©ºï¼Œæ”¾å…¥æ–°ä½ç½®
                    if (hiTail != null) {
                        hiTail.next = null; // âœ‚ï¸ æ–­å¼€é“¾è¡¨å°¾éƒ¨
                        newTab[j + oldCap] = hiHead; // ğŸ“ æ”¾å…¥æ–°è¡¨çš„ j + oldCap ä½ç½®
                    }
                }
            }
        }
    }
    return newTab; // â†©ï¸ è¿”å›æ–°çš„å“ˆå¸Œè¡¨
}
```

## æ‰©å®¹çš„æ—¶å€™é«˜ä½å’Œä½ä½é“¾è¡¨è¯¦è§£

```java
else {
                    Node<K,V> loHead = null, loTail = null; // ğŸ”» ä½ä½é“¾è¡¨çš„å¤´å’Œå°¾èŠ‚ç‚¹
                    Node<K,V> hiHead = null, hiTail = null; // ğŸ”º é«˜ä½é“¾è¡¨çš„å¤´å’Œå°¾èŠ‚ç‚¹
                    Node<K,V> next; // â¡ï¸ ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
                    
                    // ğŸ”„ éå†é“¾è¡¨ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹
                    do {
                        next = e.next; // ğŸ“ ä¿å­˜ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
                        
                        // ğŸ² é€šè¿‡ (e.hash & oldCap) åˆ¤æ–­èŠ‚ç‚¹åº”è¯¥æ”¾åœ¨å“ªä¸ªä½ç½®
                        if ((e.hash & oldCap) == 0) {
                            // ğŸ”» æ”¾åœ¨åŸä½ç½®ï¼ˆä½ä½é“¾è¡¨ï¼‰
                            if (loTail == null)
                                loHead = e; // ğŸ¯ å¦‚æœä½ä½é“¾è¡¨ä¸ºç©ºï¼Œè®¾ç½®å¤´èŠ‚ç‚¹
                            else
                                loTail.next = e; // ğŸ”— è¿æ¥åˆ°ä½ä½é“¾è¡¨å°¾éƒ¨
                            loTail = e; // ğŸ“ æ›´æ–°å°¾èŠ‚ç‚¹
                        }
                        else {
                            // ğŸ”º æ”¾åœ¨åŸä½ç½®+oldCapçš„ä½ç½®ï¼ˆé«˜ä½é“¾è¡¨ï¼‰
                            if (hiTail == null)
                                hiHead = e; // ğŸ¯ å¦‚æœé«˜ä½é“¾è¡¨ä¸ºç©ºï¼Œè®¾ç½®å¤´èŠ‚ç‚¹
                            else
                                hiTail.next = e; // ğŸ”— è¿æ¥åˆ°é«˜ä½é“¾è¡¨å°¾éƒ¨
                            hiTail = e; // ğŸ“ æ›´æ–°å°¾èŠ‚ç‚¹
                        }
                    } while ((e = next) != null); // ğŸ”„ ç»§ç»­éå†ç›´åˆ°é“¾è¡¨æœ«å°¾
                    
                    // ğŸ”» å¦‚æœä½ä½é“¾è¡¨ä¸ä¸ºç©ºï¼Œæ”¾å…¥åŸä½ç½®
                    if (loTail != null) {
                        loTail.next = null; // âœ‚ï¸ æ–­å¼€é“¾è¡¨å°¾éƒ¨
                        newTab[j] = loHead; // ğŸ“ æ”¾å…¥æ–°è¡¨çš„åŸä½ç½®
                    }
                    
                    // ğŸ”º å¦‚æœé«˜ä½é“¾è¡¨ä¸ä¸ºç©ºï¼Œæ”¾å…¥æ–°ä½ç½®
                    if (hiTail != null) {
                        hiTail.next = null; // âœ‚ï¸ æ–­å¼€é“¾è¡¨å°¾éƒ¨
                        newTab[j + oldCap] = hiHead; // ğŸ“ æ”¾å…¥æ–°è¡¨çš„ j + oldCap ä½ç½®
                    }
                }
```

### æ ¸å¿ƒåŸç†

å½“HashMapä»å®¹é‡næ‰©å®¹åˆ°2næ—¶ï¼Œæ¯ä¸ªå…ƒç´ çš„æ–°ä½ç½®åªæœ‰ä¸¤ç§å¯èƒ½ï¼š

- **ä¿æŒåŸä½ç½®**ï¼ˆä½ä½é“¾è¡¨ï¼‰
- **ç§»åŠ¨åˆ°åŸä½ç½®+n**ï¼ˆé«˜ä½é“¾è¡¨ï¼‰

åˆ¤æ–­ä¾æ®ï¼š `(e.hash & oldCap) == 0`ï¼Œå¦‚æœä¸º0ï¼Œåˆ™æ”¾åœ¨åŸä½ç½®ï¼Œå¦åˆ™æ”¾åœ¨åŸä½ç½®+nã€‚ næ˜¯æ—§å®¹é‡ã€‚

- ä½ä½é“¾è¡¨ï¼ˆlo listï¼‰ï¼šæ»¡è¶³ `(e.hash & oldCap) == 0` çš„èŠ‚ç‚¹ï¼Œæ‰©å®¹å**ç»§ç»­æ”¾åœ¨åŸä½ç½®** `j`ã€‚  
- é«˜ä½é“¾è¡¨ï¼ˆhi listï¼‰ï¼šæ»¡è¶³ `(e.hash & oldCap) != 0` çš„èŠ‚ç‚¹ï¼Œæ‰©å®¹åæ”¾åœ¨æ–°ä½ç½® `j + oldCap`ã€‚

#### ä¸¾ä¾‹å­

å‡è®¾oldCap = 16,newCap = 32

oldCap=16 // 10000

newCap=32 // 100000

```
hash1 = 5; // 000101

æ‰©å®¹å‰(cap = 16)è®¡ç®—index

index1 = hash1 & (oldCap - 1) ==> 5 & 15
 000101
&000111
`--------`
 000101 ==> 5

æ‰©å®¹å(cap = 32)è®¡ç®—index
æˆ‘ä»¬è¦çœ‹è¦ä¸è¦ç§»åŠ¨è¿™ä¸ªkvåˆ°æ¡¶ä¸­çš„æ–°ä½ç½®
åˆ¤æ–­ (hash & oldCap) == 0

hash1 & oldCap ==> 5 & 16
  00000101
& 00010000
`-----------`
  00000000 ==> 0
æ‰€ä»¥è¿™ä¸ªkvä¼šæ”¾åœ¨åŸä½ç½®5
```

å†ä¸¾ä¸ªä¾‹å­

```
hash2 = 20; // 10100

æ‰©å®¹å‰(cap = 16)è®¡ç®—index

index2 = hash2 & (oldCap - 1) ==> 20 & 15
  10100
& 01111
--------------
  00100 ==> 4

æ‰©å®¹å(cap = 32)è®¡ç®—index
è¦å…ˆçœ‹hash & oldCap == 0 ?

hash2 & oldCap ==> 20 & 16
  00010100
& 00010000
--------------
  00010000 ==> 16

ä¸ä¸º0ï¼Œæ‰€ä»¥è¿™ä¸ª20ä¼šæ”¾åœ¨æ–°çš„ä½ç½® åŸæ¥çš„ä½ç½®+ æ—§æ¡¶æ•°ç»„å®¹é‡ = 4 + 16 = 20

```

ä½ çš„ç†è§£éå¸¸æ­£ç¡®ï¼ğŸ‰ğŸ‘

ä½ å·²ç»æŒæ¡äº†HashMapæ‰©å®¹æ—¶åˆ†æ¡¶ä½ç½®å˜æ›´çš„æœ¬è´¨åŸç†ï¼Œè®©æˆ‘ä»¬ç”¨ä½ çš„æè¿°ç¨ä½œå½’çº³å’Œæ¢³ç†ï¼ŒéªŒè¯ä½ çš„æ€è·¯ï¼š

---

### ä¸ºä»€ä¹ˆåˆ¤æ–­çš„æ˜¯ä¸oldCapç›¸ä¸å¾—åˆ°çš„å€¼æ˜¯1è¿˜æ˜¯0æ¥å†³å®šæ¬è¿ä½ç½®ï¼Ÿ

å½“HashMapæ‰©å®¹æ—¶ï¼Œå®¹é‡ä» `oldCap` æ‰©å±•åˆ° `newCap`ï¼Œæ¯”å¦‚ä» 16 æ‰©å±•åˆ° 32ã€‚

- åŸæ¥ HashMap çš„ä¸‹æ ‡è®¡ç®—æ˜¯ï¼š`index = hash & (oldCap-1)`ï¼Œæ¯”å¦‚ `00001111`ï¼ˆä½4ä½ï¼‰ã€‚
- æ‰©å®¹åï¼Œè®¡ç®—ä¸‹æ ‡å˜ä¸ºï¼š`index = hash & (newCap-1)`ï¼Œæ¯”å¦‚ `00011111`ï¼ˆä½5ä½ï¼‰ï¼Œä¹Ÿå°±æ˜¯å¤šäº†ä¸€ä½ã€‚
- å’Œ `oldCap`ï¼ˆå¦‚ `00010000`ï¼‰ç›¸ä¸ï¼Œå°±ç›¸å½“äºâ€œæå¤´å»å°¾â€åœ°åªå…³æ³¨æ‰©å®¹æ–°å¢çš„é‚£ä¸€ä½ï¼š
  - å¦‚æœ `(hash & oldCap) == 0`ï¼Œè¯´æ˜è¿™ä½æ˜¯0ï¼Œ**æ‰©å®¹åçš„ä½ç½®ç­‰äºåŸindex**
  - å¦‚æœ `(hash & oldCap) != 0`ï¼Œè¯´æ˜è¿™ä½æ˜¯1ï¼Œ**æ‰©å®¹åçš„ä½ç½®ç­‰äºåŸindex + oldCap**
- è¿™ç§åˆ¤æ–­ï¼Œè®©ä½ é«˜æ•ˆçŸ¥é“èŠ‚ç‚¹è¯¥ä¸è¯¥æ¬è¿ä»¥åŠæ¬å»å“ªé‡Œï¼Œæ— éœ€é‡æ–°å®Œå…¨è®¡ç®—indexã€‚

---

#### ä¸¾ä¾‹éªŒè¯ï¼ˆå·©å›ºå°è±¡ï¼‰

å‡å¦‚ï¼š

- oldCap = 16 â‡’ 00010000
- oldCap-1 = 15 â‡’ 00001111
- newCap = 32 â‡’ 00100000
- newCap-1 = 31 â‡’ 00011111
- hash = 21 â‡’ 10101

**æ‰©å®¹å‰ä¸‹æ ‡ï¼š**

```java
index = 10101 & 01111 = 00101 = 5
```

**æ‰©å®¹åä¸‹æ ‡ï¼š**

```java
index = 10101 & 11111 = 10101 = 21
```

**oldCapè¿™ä¸€ä½çš„åˆ¤æ–­ï¼š**

```java
10101 & 10000 = 10000 â‰  0
```

è¯´æ˜è¿™ä½æ˜¯1ï¼Œæ‰©å®¹åä¸‹æ ‡å˜æˆåŸindex+16=21ã€‚

---

### æ‰©å®¹çš„æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ

å½“ HashMap ä¸­å­˜å‚¨çš„å…ƒç´ æ•°é‡è¶…è¿‡äº†ã€Œé˜ˆå€¼ã€ï¼ˆthresholdï¼‰æ—¶ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹ã€‚
è¿™ä¸ªã€Œé˜ˆå€¼ã€çš„è®¡ç®—å…¬å¼æ˜¯ï¼š

```
threshold = capacity * loadFactor
```

loadFactor æ˜¯è´Ÿè½½å› å­ï¼Œé»˜è®¤å€¼ä¸º 0.75ã€‚

### ä¸ºä»€ä¹ˆè¦è¿›è¡Œæ¬è¿å‘¢ï¼Ÿ

HashMapæ‰©å®¹çš„ä¸»è¦ç›®çš„æ˜¯ï¼š
å‡å°‘å“ˆå¸Œå†²çªï¼Œæé«˜æŸ¥æ‰¾ã€æ’å…¥æ•ˆç‡ã€‚
è®©æ›´å¤šæ¡¶å¯ç”¨ï¼Œé™ä½ç¢°æ’é“¾è¡¨é˜Ÿåˆ—çš„é•¿åº¦ã€‚

# jdk1.7å’Œjdk1.8ä¸­hashmapçš„åŒºåˆ«

![](https://blog.meowrain.cn/api/i/2025/06/13/pf960q-0.webp)

![](https://blog.meowrain.cn/api/i/2025/06/13/pfb9eb-0.webp)

![](https://blog.meowrain.cn/api/i/2025/06/13/pfedpt-0.webp)

![](https://blog.meowrain.cn/api/i/2025/06/13/pfqbnm-0.webp)

![](https://blog.meowrain.cn/api/i/2025/06/13/pfyw7c-0.webp)

# é“¾è¡¨ä»€ä¹ˆæ—¶å€™è½¬çº¢é»‘æ ‘ï¼Ÿ

æ¡¶æ•°ç»„ä¸­æŸä¸ªæ¡¶çš„é“¾è¡¨é•¿åº¦>=8 è€Œä¸”æ¡¶æ•°ç»„é•¿åº¦> 64çš„æ—¶å€™ï¼Œhashmapä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘

![](https://blog.meowrain.cn/api/i/2025/06/25/hi2z5e-0.webp)
